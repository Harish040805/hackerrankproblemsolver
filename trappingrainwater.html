<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Rain Water Trapping Simulator</title>
<style>
    body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: Arial, sans-serif;
        background: linear-gradient(to bottom, #999, #aaa, #ccc, #bbb);
        overflow: hidden;
    }
    #controls {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(255,255,255,0.9);
        padding: 10px;
        border-radius: 8px;
        z-index: 10;
    }
    #controls input {
        width: 200px;
        margin-bottom: 5px;
        padding: 5px;
    }
    #controls button {
        padding: 5px 10px;
        cursor: pointer;
    }
    canvas {
        display: block;
    }
</style>
</head>
<body>

<div id="controls">
    <label>Enter heights (comma separated):</label><br>
    <input type="text" id="heightInput" placeholder="e.g., 0,1,0,2,1,0,1,3,2,1,2,1"><br>
    <button id="simulateBtn">Simulate Rainfall</button>
    <div id="output" style="margin-top:5px;font-weight:bold;"></div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let heights = [];
let waterArray = [];
let totalWater = 0;
let scale = 20; // pixels per unit height
let offsetX = 50;
let offsetY = 50;

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    drawGraph();
});

document.getElementById('simulateBtn').addEventListener('click', () => {
    const input = document.getElementById('heightInput').value;
    heights = input.split(',').map(Number);
    const result = trap(heights);
    waterArray = result.waterArray;
    totalWater = result.total;
    document.getElementById('output').innerText = `Total Trapped Water: ${totalWater}`;
    drawGraph();
});

function trap(height) {
    if (!height || height.length === 0) return { total: 0, waterArray: [] };
    const n = height.length;
    const leftMax = new Array(n).fill(0);
    const rightMax = new Array(n).fill(0);
    leftMax[0] = height[0];
    for (let i = 1; i < n; i++) leftMax[i] = Math.max(leftMax[i-1], height[i]);
    rightMax[n-1] = height[n-1];
    for (let i = n-2; i >=0; i--) rightMax[i] = Math.max(rightMax[i+1], height[i]);
    const waterArr = new Array(n).fill(0);
    let water = 0;
    for (let i=0;i<n;i++){
        waterArr[i] = Math.min(leftMax[i], rightMax[i]) - height[i];
        if(waterArr[i]>0) water += waterArr[i];
    }
    return { total: water, waterArray: waterArr };
}

// Zoom with mouse wheel
canvas.addEventListener('wheel', e => {
    e.preventDefault();
    const delta = e.deltaY < 0 ? 1.1 : 0.9;
    scale *= delta;
    scale = Math.max(5, Math.min(scale, 100));
    drawGraph();
});

// Draw axes and bars
function drawGraph() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawAxes();
    drawBars();
}

function drawAxes() {
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 2;
    // y-axis
    ctx.beginPath();
    ctx.moveTo(offsetX, offsetY);
    ctx.lineTo(offsetX, canvas.height - offsetY);
    ctx.stroke();
    // x-axis
    ctx.beginPath();
    ctx.moveTo(offsetX, canvas.height - offsetY);
    ctx.lineTo(canvas.width - offsetX, canvas.height - offsetY);
    ctx.stroke();

    // dynamic ticks
    ctx.fillStyle = '#fff';
    ctx.font = '12px Arial';
    // y ticks
    for (let y = 0; y <= (canvas.height - 2*offsetY)/scale; y++) {
        const py = canvas.height - offsetY - y*scale;
        ctx.beginPath();
        ctx.moveTo(offsetX-5, py);
        ctx.lineTo(offsetX+5, py);
        ctx.stroke();
        ctx.fillText(y, 5, py+3);
    }
    // x ticks
    for (let x=0; x<=(canvas.width - 2*offsetX)/scale; x++) {
        const px = offsetX + x*scale;
        ctx.beginPath();
        ctx.moveTo(px, canvas.height - offsetY-5);
        ctx.lineTo(px, canvas.height - offsetY+5);
        ctx.stroke();
        ctx.fillText(x, px-5, canvas.height - offsetY + 20);
    }
}

function drawBars() {
    if(!heights.length) return;
    for(let i=0;i<heights.length;i++){
        const barHeight = heights[i]*scale;
        const x = offsetX + i*scale;
        const y = canvas.height - offsetY - barHeight;
        // bar
        ctx.fillStyle = '#3498db';
        ctx.fillRect(x, y, scale*0.8, barHeight);
        // water
        if(waterArray[i]>0){
            const waterHeight = waterArray[i]*scale;
            ctx.fillStyle = 'rgba(52, 152, 219, 0.5)';
            ctx.fillRect(x, y - waterHeight, scale*0.8, waterHeight);
        }
    }
}
</script>

</body>
</html>
